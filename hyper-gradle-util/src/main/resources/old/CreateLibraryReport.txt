target.tasks.create("testR", DependencyReportTask::class) {
    val dependencies = mutableSetOf<String>()

    target.afterEvaluate {
        target.configurations.compileClasspath.configure {
            resolutionStrategy.eachDependency {
                val target = this.target
                val id = "${target.group}:${target.name}:${target.version}"
                dependencies.add(id)
            }
        }
    }

    doLast {
        dependencies.forEach(::println)
        println(dependencies.size)
    }
}